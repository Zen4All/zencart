<?php

namespace Tests\FeatureStore\TaxCalculations\TestBasicTaxCalculationsNoShippingTax;

use Symfony\Component\DomCrawler\Crawler;
use Tests\Support\zcFeatureTestCaseStore;

class BasicTaxShippingBillingNoShippingTest extends zcFeatureTestCaseStore
{
    private static $ready = false;
    public function setUp(): void
    {
        parent::setUp(); // TODO: Change the autogenerated stub
        if (static::$ready) {
            return;
        }
        static::$ready = true;
    }

    /**
     * @test
     * scenario BTC 1
     */
    public function testBasicCheckoutFloridaCustomer()
    {
        $this->createCustomerAccountOrLogin('florida-basic1');
        $this->browser->request('GET', HTTP_SERVER . '/index.php?main_page=product_info&products_id=25');
        $response = $this->browser->getResponse();
        $this->assertStringContainsString('Microsoft', (string)$response->getContent() );
        $this->browser->submitForm('Add to Cart', [
            'cart_quantity' => '1',
            'products_id' => '25',
            ]);
        $response = $this->browser->getResponse();
        $this->assertStringContainsString('Your Shopping Cart Contents', (string)$response->getContent() );
        $this->browser->request('GET', HTTP_SERVER . '/index.php?main_page=checkout_shipping');
        $response = $this->browser->getResponse();
        $this->assertStringContainsString('Delivery Information', (string)$response->getContent() );
        $this->browser->submitForm('Continue', [
        ]);
        $response = $this->browser->getResponse();
        $this->assertStringContainsString('Payment Information', (string)$response->getContent() );
        $crawler = new Crawler((string)$response->getContent());
        $this->assertStringContainsString('69.99', $crawler->filter('#checkoutOrderTotals')->text());
        $this->assertStringContainsString('2.50', $crawler->filter('#checkoutOrderTotals')->text());
        $this->assertStringContainsString('4.90', $crawler->filter('#checkoutOrderTotals')->text());
        $this->assertStringContainsString('77.39', $crawler->filter('#checkoutOrderTotals')->text());
        $this->browser->submitForm('Continue', []);
        $response = $this->browser->getResponse();
        $crawler = new Crawler((string)$response->getContent());
        $this->assertStringContainsString('Order Confirmation', $crawler->filter('#checkoutConfirmDefaultHeading')->text());
        $this->assertStringContainsString('69.99', $crawler->filter('#orderTotals')->text());
        $this->assertStringContainsString('2.50', $crawler->filter('#orderTotals')->text());
        $this->assertStringContainsString('4.90', $crawler->filter('#orderTotals')->text());
        $this->assertStringContainsString('77.39', $crawler->filter('#orderTotals')->text());
        $this->browser->submitForm('btn_submit_x', [
        ]);
        $response = $this->browser->getResponse();
        $crawler = new Crawler((string)$response->getContent());
        $this->assertStringContainsString('Your Order Number is:', $crawler->filter('#checkoutSuccessOrderNumber')->text());
    }

    /**
     * @test
     * scenario BTC 2
     */
    public function testBasicCheckoutNonFloridaCustomer()
    {
        $this->createCustomerAccountOrLogin('US-not-florida-basic');
        $this->browser->request('GET', HTTP_SERVER . '/index.php?main_page=product_info&products_id=25');
        $response = $this->browser->getResponse();
        $this->assertStringContainsString('Microsoft', (string)$response->getContent() );
        $this->browser->submitForm('Add to Cart', [
            'cart_quantity' => '1',
            'products_id' => '25',
        ]);
        $response = $this->browser->getResponse();
        $this->assertStringContainsString('Your Shopping Cart Contents', (string)$response->getContent() );
        $this->browser->request('GET', HTTP_SERVER . '/index.php?main_page=checkout_shipping');
        $response = $this->browser->getResponse();
        $this->assertStringContainsString('Delivery Information', (string)$response->getContent() );
        $this->browser->submitForm('Continue', [
        ]);
        $response = $this->browser->getResponse();
        $this->assertStringContainsString('Payment Information', (string)$response->getContent() );
        $crawler = new Crawler((string)$response->getContent());
        $this->assertStringContainsString('69.99', $crawler->filter('#checkoutOrderTotals')->text());
        $this->assertStringContainsString('2.50', $crawler->filter('#checkoutOrderTotals')->text());
        $this->assertStringContainsString('72.49', $crawler->filter('#checkoutOrderTotals')->text());
        $this->browser->submitForm('Continue', []);
        $response = $this->browser->getResponse();
        $crawler = new Crawler((string)$response->getContent());
        $this->assertStringContainsString('Order Confirmation', $crawler->filter('#checkoutConfirmDefaultHeading')->text());
        $this->assertStringContainsString('69.99', $crawler->filter('#orderTotals')->text());
        $this->assertStringContainsString('2.50', $crawler->filter('#orderTotals')->text());
        $this->assertStringContainsString('72.49', $crawler->filter('#orderTotals')->text());
        $this->browser->submitForm('btn_submit_x', [
        ]);
        $response = $this->browser->getResponse();
        $crawler = new Crawler((string)$response->getContent());
        $this->assertStringContainsString('Your Order Number is:', $crawler->filter('#checkoutSuccessOrderNumber')->text());
    }
}
